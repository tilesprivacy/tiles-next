/**
 * One-off script: extract PNG from wireframe.svg, output WebP + blur base64.
 * Run: node scripts/extract-wireframe.mjs
 */
import fs from "fs";
import path from "path";
import { fileURLToPath } from "url";
import sharp from "sharp";

const __dirname = path.dirname(fileURLToPath(import.meta.url));
const root = path.join(__dirname, "..");
const svgPath = path.join(root, "public", "wireframe.svg");
const webpPath = path.join(root, "public", "wireframe.webp");
const blurModulePath = path.join(root, "lib", "wireframe-blur.ts");

const svg = fs.readFileSync(svgPath, "utf8");
const match = svg.match(/data:image\/png;base64,([^"]+)/);
if (!match) throw new Error("No base64 PNG found in wireframe.svg");
const buffer = Buffer.from(match[1], "base64");

await sharp(buffer)
  .webp({ quality: 82, effort: 4 })
  .toFile(webpPath);
console.log("Wrote", webpPath);

const blurBuffer = await sharp(buffer)
  .resize(32)
  .webp({ quality: 40 })
  .toBuffer();
const blurDataURL = "data:image/webp;base64," + blurBuffer.toString("base64");

const moduleContent = `// Generated by scripts/extract-wireframe.mjs â€“ do not edit by hand
export const WIREFRAME_BLUR_DATA_URL = ${JSON.stringify(blurDataURL)};
`;
fs.writeFileSync(blurModulePath, moduleContent);
console.log("Wrote", blurModulePath);
